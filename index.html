<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <meta name="generator" content="pandoc">
  <meta name="dcterms.date" content="2020-03-17">
  <title>Verification and Validation of MOM6</title>
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, minimal-ui">
  <link rel="stylesheet" href="./reveal.js/dist/reveal.css">
  <style type="text/css">
      code{white-space: pre-wrap;}
      span.smallcaps{font-variant: small-caps;}
      span.underline{text-decoration: underline;}
      div.column{display: inline-block; vertical-align: top; width: 50%;}
  </style>
  <link rel="stylesheet" href="./reveal.js/css/theme/gfdl.css" id="theme">
  <!-- Explicitly add zenburn for highlight support -->
  <link rel="stylesheet" href="./reveal.js/plugin/highlight/zenburn.css" id="theme">
  <!-- Printing and PDF exports -->
  <script>
    var link = document.createElement( 'link' );
    link.rel = 'stylesheet';
    link.type = 'text/css';
    link.href = window.location.search.match( /print-pdf/gi ) ? './reveal.js/css/print/pdf.scss' : './reveal.js/css/print/paper.scss';
    document.getElementsByTagName( 'head' )[0].appendChild( link );
  </script>
  <!--[if lt IE 9]>
  <script src="./reveal.js/lib/js/html5shiv.js"></script>
  <![endif]-->
  <base href="./index.html">
</head>
<body>
  <div class="reveal"
       style="background: url(img/bg_gfdl.jpg);
              background-size: cover;">

    <!-- Original ratio: 10.04" x 7.08" -->
    <div style="height: 100vh; position: absolute; bottom: -50vh; left: -40vh">
      <img style="height: 100vh; width: 142vh" src="img/bg_globe.png">
    </div>

    <header style="width: 10vh; position: absolute; bottom: 2vh; right: 2vh;">
      <img src="img/noaa_logo.png">
    </header>

    <footer style="font-size: 1pc; position: absolute; bottom: 2%; left: 2%;">
      <!--<code>https://marshallward.org/mom6vv/payucourse/index.html</code>-->
      <code>index.html</code>
    </footer>

    <div class="slides">

<section id="title-slide">
  <!--div class="reveal" style="text-align: right;">
    <img src="img/noaa_logo.png"
         style="background: none; border: none; box-shadow: none;
         width: 30%"
         alt="NCI">
  </div-->
  <h1 class="title">Verification and Validation of MOM6</h1>
  <p class="author" style="text-align: right;"><ul>
<li>Marshall Ward</li>
<li>Robert Hallberg</li>
<li>Alistair Adcroft</li>
</ul></p>
  <p class="date" style="text-align: right;">17 March 2020</p>
</section>

<section class="slide level2">

<p><strong>Verification</strong></p>
<blockquote>
<p>Am I building the product right?</p>
</blockquote>
<p><strong>Validation</strong></p>
<blockquote>
<p>Am I building the right product?</p>
</blockquote>
<p>Barry Boehm, <em>Software Risk Management</em> (1989)</p>
</section>
<section id="verification" class="title-slide slide level1">
<h1>Verification</h1>
<p>What are the <em>design specifications</em> of my model?</p>
<ul>
<li>Does it compile on target platforms?</li>
<li>Are the equations dimensionally consistent?</li>
<li>Does parallelization change the answers?</li>
</ul>
<p><em>Verification is the confirmation of design specifications.</em></p>
</section>

<section id="validation" class="title-slide slide level1">
<h1>Validation</h1>
<p>Does our model meet operational needs?</p>
<ul>
<li>Does it produce realistic simulations?</li>
<li>Are relevant physical features present?</li>
<li>Can I reproduce my old simulations?</li>
</ul>
<p><em>Validation is an assessment of the final product.</em></p>
</section>

<section id="vv-in-development" class="title-slide slide level1">
<h1>V&amp;V in Development</h1>
<table>
<tbody>
<tr class="odd">
<td><a href="https://en.wikipedia.org/wiki/File:Waterfall_model.svg"><img data-src="img/waterfall.svg" style="width:60.0%" alt="image" /></a></td>
<td><a href="https://commons.wikimedia.org/wiki/File:Systems_Engineering_Process_II.svg"><img data-src="img/v_model.svg" alt="image" /></a></td>
</tr>
</tbody>
</table>
<p><a href="https://medium.com/open-product-management/crash-article-in-agile-development-da960861259e"><img data-src="img/agile.jpeg" style="width:50.0%" alt="image" /></a></p>
</section>

<section id="life-cycle-of-a-contribution" class="title-slide slide level1">
<h1>Life cycle of a contribution</h1>
<dl>
<dt>Figure here of patch going into a MOM6 repo</dt>
<dd><ul>
<li>Trigger Travis testing</li>
<li>Manual GitLab testing</li>
<li>Review</li>
<li>Merge</li>
</ul>
</dd>
</dl>
</section>

<section id="source-integration" class="title-slide slide level1">
<h1>Source Integration</h1>
<p><img data-src="img/gitrepos.svg" style="width:55.0%" alt="image" /></p>
</section>

<section id="verification-test-suite" class="title-slide slide level1">
<h1>Verification Test Suite</h1>
<p>Version of Bob's table here</p>
<p>List the "invariance tests" that we require for travis.</p>
<p>All hubs should</p>
</section>

<section id="bit-reproducibility" class="title-slide slide level1">
<h1>Bit reproducibility</h1>
<figure>
<video data-src="img/pilotwings_repro.mp4" controls=""><a href="img/pilotwings_repro.mp4"></a></video><figcaption>Identical code and input, different math libraries</figcaption>
</figure>
<div class="footer">
<p>test</p>
</div>
</section>

<section id="floating-point-review" class="title-slide slide level1">
<h1>Floating point review</h1>
<p><img data-src="img/IEEE_754_Double_Floating_Point_Format.svg" alt="image" /></p>
<p><span class="math display">\[(-1)^s \times 1.\{\text{frac}\}\times 2^{\{\text{exp}\}}\]</span></p>
<ul>
<li>Smallest fractional diff: <span class="math inline">\(2^{-52} \approx 2.2 \times 10^{-16}\)</span></li>
<li>17 digits to uniquely specify a result</li>
</ul>
</section>

<section>
<section id="associativity" class="title-slide slide level1">
<h1>Associativity</h1>
<ul>
<li><p><span class="math inline">\(10^{-16} + 1 - 1 = ?\)</span></p>
<ul>
<li class="fragment"><span class="math inline">\((10^{-16} + 1) - 1 = 0\)</span></li>
<li class="fragment"><span class="math inline">\(10^{-16} + (1 - 1) \approx 1.1 \times 10^{-16}\)</span></li>
</ul></li>
<li><p><span class="math inline">\(1 + 2 \times 10^{-16} - 10^{-16} = ?\)</span></p>
<ul>
<li class="fragment"><span class="math inline">\((1 + 2 \times 10^{-16}) - 10^{-16}
       \approx 1 + 2.2 \times 10^{-16}\)</span></li>
<li class="fragment"><span class="math inline">\(1 + (2 \times 10^{-16} - 10^{-16}) = 1\)</span></li>
</ul></li>
</ul>
</section>
<section id="more-associativity" class="slide level2">
<h2>More associativity</h2>
<p>Let <span class="math inline">\(s = 1 + 2 \times 10^{-16}\)</span>; what is <span class="math inline">\((s + 1) - 1\)</span>?</p>
<ul>
<li class="fragment"><span class="math inline">\(s + 1 = 2\)</span></li>
<li class="fragment"><span class="math inline">\((s + 1) - 1 = 1 \neq s\)</span></li>
</ul>
<p>Manipulation of <span class="title-ref">s</span> removed the least significant bit.</p>
</section></section>
<section id="multiplication-associativity" class="title-slide slide level1">
<h1>Multiplication associativity</h1>
<p>Multiplication is less sensitive, but nonetheless depends on associativity:</p>
<p>If <span class="math inline">\(a = b = 1.5\)</span>, and <span class="math inline">\(c = 1 + 2^{-52}\)</span>, then</p>
<p><span class="math display">\[\begin{aligned}
(a \times b) \times c &amp;= 2.25 + 2^{-51} \\
a \times (b \times c) &amp;= 2.25 + 2^{-50}
\end{aligned}\]</span></p>
<p>Note power-of-two (radix) multiplication is reversible (up to over/underflow!)</p>
</section>

<section>
<section id="integrity-of-parentheses" class="title-slide slide level1">
<h1>Integrity of parentheses</h1>
<p>V&amp;V requires integrity of parentheses</p>
<p>GCC Fortran:</p>
<pre><code>gfortran -fprotect-parens ...    # default
gfortran -Ofast ...              # Sets -fno-protect-parens</code></pre>
<p>Intel Fortran:</p>
<pre><code>ifort -assume protect-parens     # Not default</code></pre>
<p>Note: Standard requires (J3/18-007r1, 10.1.5)</p>
</section>
<section id="kahan-summation" class="slide level2">
<h2>Kahan summation</h2>
<p>Attach here? See <a href="https://groups.google.com/forum/#!topic/comp.lang.fortran/D-tFxYgHa_4">https://groups.google.com/forum/#!topic/comp.lang.fortran/D-tFxYgHa_4</a></p>
</section></section>
<section id="parallel-summation" class="title-slide slide level1">
<h1>Parallel summation</h1>
<p>Problem is extended to parallel sums:</p>
<p>See hallberg &amp; adcroft</p>
</section>

<section id="algorithmic-ordering" class="title-slide slide level1">
<h1>Algorithmic ordering</h1>
<p>Show xfirst/yfirst flag example</p>
</section>

<section id="rotational-invariance" class="title-slide slide level1">
<h1>Rotational invariance</h1>
<p>Show bob's pictures</p>
</section>

<section id="checksum-validation" class="title-slide slide level1">
<h1>Checksum validation</h1>
<ul>
<li>Compute domain (no halos, no symmetric boundary)</li>
<li>sum(abs()) (negative zero!)</li>
<li><dl>
<dt>"Hash":</dt>
<dd><ul>
<li>Min, max, mean (reproducible)</li>
<li>Bitcount checksums (incl. halo shifted counts)</li>
</ul>
</dd>
</dl></li>
<li>Paired sums for rotational invariance</li>
</ul>
</section>

<section id="dimensional-scaling" class="title-slide slide level1">
<h1>Dimensional scaling</h1>
<ul>
<li><p>Float: (-1)^s * 1.(mmm...m) * 2^(nnn...n)</p>
<p>Bits: smmm....mnnn....n</p></li>
<li><p>2^N scaling is an integer shift of yyyy which is reproducibly reversible</p>
<p>... up to over/underflow of yyyy!</p></li>
<li><dl>
<dt>Ideal procedure:</dt>
<dd><ul>
<li>Scale at input</li>
<li>Manipulate rescaled numbers</li>
<li>De-scale at output, checksum, etc</li>
</ul>
</dd>
</dl></li>
</ul>
</section>

<section id="examples-of-dimensional-errors" class="title-slide slide level1">
<h1>Examples of Dimensional Errors</h1>

</section>

<section id="travis-testing" class="title-slide slide level1">
<h1>Travis Testing</h1>
<ul>
<li>Code validation tests</li>
<li>Platform independent</li>
</ul>
</section>

<section id="test-build-configuration" class="title-slide slide level1">
<h1>Test build configuration</h1>
<ul>
<li>GCC Fortran 9.x</li>
<li><dl>
<dt>Full warnings</dt>
<dd><ul>
<li>Permit float inequality with zero</li>
</ul>
</dd>
</dl></li>
<li><dl>
<dt>Stack initialization</dt>
<dd><ul>
<li>Signal NaN for float</li>
<li>2^(N-1) - 1 for integer, logical</li>
</ul>
</dd>
</dl></li>
</ul>
</section>

<section id="running-on-travis" class="title-slide slide level1">
<h1>Running on Travis</h1>
<ul>
<li>Makefile is standalone, but can be configured by Travis:
<ul>
<li>DO_REGRESSION_TESTS</li>
<li>MOM_TARGET_SLUG</li>
<li>MOM_TARGET_LOCAL_BRANCH</li>
</ul></li>
</ul>
</section>

<section id="gaea-regression-tests" class="title-slide slide level1">
<h1>Gaea regression tests</h1>
<ul>
<li>Full suite, platform specific, run on Gaea</li>
<li>Each development hub would ideally have its own regression tests</li>
</ul>
</section>

<section id="todo" class="title-slide slide level1">
<h1>TODO</h1>
<ul>
<li>Valgrind testing</li>
<li>Code coverage</li>
<li>Zero-warnings</li>
</ul>
</section>

<section id="and-the-future" class="title-slide slide level1">
<h1>And the future</h1>
<ul>
<li>Cyclomatic (McCabe) complexity</li>
<li>AST analyzer</li>
<li>Fortran lint tools (flint??)</li>
</ul>
</section>
    </div>
  </div>

  <script src="./reveal.js/dist/reveal.js"></script>
  <script src="./reveal.js/plugin/math/math.js"></script>

  <script>

      // Full list of configuration options available at:
      // https://github.com/hakimel/reveal.js#configuration
      Reveal.initialize({
        // Display the page number of the current slide
        slideNumber: true,
        // Push each slide change to the browser history
        history: true,
        math: {
          mathjax: 'https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js',
          config: 'TeX-AMS_HTML-full',
          //TeX: {
          //  inlineMath: [['\\(','\\)']],
          //  displayMath: [['\\[','\\]']],
          //  balanceBraces: true,
          //  processEscapes: false,
          //  processRefs: true,
          //  processEnvironments: true,
          //  preview: 'TeX',
          //  skipTags: ['script','noscript','style','textarea','pre','code'],
          //  ignoreClass: 'tex2jax_ignore',
          //  processClass: 'tex2jax_process'
          //},
        },

        // Optional reveal.js plugins
        dependencies: [
          { src: './reveal.js/lib/js/classList.js', condition: function() { return !document.body.classList; } },
          { src: './reveal.js/plugin/zoom-js/zoom.js', async: true },
          { src: './reveal.js/plugin/math/math.js', async: true },
          { src: './reveal.js/plugin/highlight/highlight.js',
            async: true,
            condition: function() {
              return !!document.querySelector( 'pre code' ); },
            callback: function() {
              hljs.initHighlightingOnLoad(); }
          },
          { src: './reveal.js/plugin/notes/notes.js', async: true }
        ],
        plugins : [ RevealMath ],
      });
    </script>
    </body>
</html>
